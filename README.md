# transposable-virus-insertion-site-finder
Runs pipeline to quantify virus reads within isolate or deep coverage samples.

```
#Code by:      Cris Vera
#Group:        IGOH Theme, IGB, University of Illinois
#Date:         06-24-2019
#Contact:      jcvera@illinois.edu
```
# Description: 
+ runs pipeline to quantify virus reads within isolate or deep coverage samples. Uses an unmodifed virus genome reference with either unmodifed or mod2 modified host genome reference (i.e. mod2=remove prophage sequence if it exists).
+ Runs the main quantification script (EditSAMs_CountVirusPositions) directly on SAM file of each sample for generation of broad overview sample figures
+ Also runs a virus locator script on all the samples (summary file output) to locate virus insertion sites within 500bp bins for multiple isolate samples. This can be run on deep coverage samples as well, but will return less useful results, since it's intended to detect virus insertion site movement between isolate samples.
+ Finally, runs the overlap detection script on each sample to list out exact virus insertion locations (for mu-like phages where there's an insertion overlap region). This is intended for use on deep coverage samples, but it can be run on isolates with a mu-like phage as well.

This pipeline runs on top of the directory structure generated by our QC pipelines. It's recommended that you run your reads through both pipelines; the QC_pipeline first, and the transposable-insertion-site-finder second. See the [IGOH QC_pipeline repository](https://github.com/igoh-illinois/QC_pipeline) for details on running the initial QC pipeline. 

All scripts should be housed in the same folder. 


### Notes:
To prep a Host/Virus DB:
1. If the Host reference contains the prophage, remove it using the PrepGenome script.  I tag references with modified host genomes with '_mod2'
  - e.g.: `UnFastaFormat.pl -i HostGenomeFile.fasta | PrepGenome.pl -r 1:5000:25000 | FastaFormat.pl -o HostGenomeFile.mod2.fasta`
2. Concatenate the Host reference with the Phage reference
  - e.g.: `cat HostGenomeFile.mod2.fasta PhageGenomeFile.fasta >HostAndPhageGenomeFile.fasta`
3. Run BWA index
  - e.g.: `bwa index HostAndPhageGenomeFile.fasta`
4. Add to this script.

## Command line options: 
```
Run_VirusMapPipeline_QuantifyVirusReads . Runs pipeline to quantify virus reads within isolate or deep coverage samples.

	-d  Option: specify input directory.  Required.
	-e  Option: specify output directory. Default='out/'.
	-t  Option: specify number of threads. Default=8.
	-p  Option: specify project name (summary file base). Default='PA'.
	-b  Option: specify quantification bin size. Default=1000.
	-f  Option: specify minimum overlap coverage. Default=2.
	-V  Option: specify Hybrid Host/Virus DB to use. Default=1.
		1: CF_1_A12_F10-like (10)
		2: CF_1_A12_H10_vir (10)
		3: PA14-RJW_PhageTS1-Ref (11)
		4: PA14-RW_DMS3 (11)

Example command: 
Run_VirusMapPipeline_IGOH_QuantifyVirusReads.pl -d [Input Dir] -e [Output Dir] -p [Project Name] -V [Host/Virus BWA DB] -b [Bin Size] -f [Min Overlap Coverage]
```

